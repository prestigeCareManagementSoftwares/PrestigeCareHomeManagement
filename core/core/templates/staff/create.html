{% extends "core/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container-fluid">
    <form method="post" enctype="multipart/form-data" id="residentForm">
        {% csrf_token %}
        <div class="row">
            <!-- Main Form Column -->
            <div class="col-lg-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <h4 class="mb-0">Resident Form</h4>
                    </div>
                    <div class="card-body">
                        <!-- First / Last Name -->
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.first_name|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.last_name|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Gender / Date of Birth -->
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.gender|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.date_of_birth|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Email / Phone -->
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.email|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.phone_number|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Address / City -->
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.address|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.city|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Postcode / Carehome -->
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.postcode|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.carehome|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Next of Kin Section -->
                        <h5 class="mt-4">Next of Kin Details</h5>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.next_of_kin_name|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.next_of_kin_phone|as_crispy_field }}
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.next_of_kin_relation|as_crispy_field }}
                            </div>
                            <div class="form-group col-md-6">
                                {{ form.next_of_kin_email|as_crispy_field }}
                            </div>
                        </div>

                        <!-- Password Field (only in edit_mode) -->
                        {% if edit_mode %}
                        <h5 class="mt-4">Account Security</h5>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                {{ form.password|as_crispy_field }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-group text-right mb-4">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a href="{% url 'residents_list' %}" class="btn btn-secondary">Cancel</a>
                </div>
            </div>

            <!-- Preview Column -->
            <div class="col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">Preview</h5>
                    </div>
                    <div class="card-body text-center">
                        {% if form.instance.photo %}
                            <img src="{{ form.instance.photo.url }}" class="img-fluid rounded-circle mb-3" alt="Resident Photo">
                        {% else %}
                            <img src="{% static 'images/default-avatar.png' %}" class="img-fluid rounded-circle mb-3" alt="Default Avatar">
                        {% endif %}
                        {{ form.photo|as_crispy_field }}
                        <p class="mt-3 mb-0"><strong>{{ form.instance.first_name }} {{ form.instance.last_name }}</strong></p>
                        <p class="text-muted">{{ form.instance.carehome }}</p>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
